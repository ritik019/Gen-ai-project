<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foodie AI - Smart Restaurant Finder</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: #0f0f1a;
    color: #e0e0e0;
    min-height: 100vh;
  }

  /* --- Header --- */
  header {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    padding: 2rem 2rem 0;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .logo { font-size: 2rem; font-weight: 700; color: #fff; letter-spacing: -0.5px; }
  .logo span { color: #f97316; }
  header .subtitle { font-size: 0.9rem; color: rgba(255,255,255,0.5); margin-top: 0.5rem; }

  /* Nav tabs */
  .nav-tabs {
    display: flex;
    justify-content: center;
    gap: 0;
    margin-top: 1.5rem;
  }
  .nav-tab {
    padding: 0.7rem 1.8rem;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    color: rgba(255,255,255,0.4);
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    user-select: none;
  }
  .nav-tab:hover { color: rgba(255,255,255,0.7); }
  .nav-tab.active { color: #f97316; border-bottom-color: #f97316; }

  /* --- Layout --- */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    display: grid;
    grid-template-columns: 360px 1fr;
    gap: 2rem;
    align-items: start;
  }

  .view { display: none; }
  .view.active { display: block; }
  .view-search.active { display: grid; grid-template-columns: 360px 1fr; gap: 2rem; align-items: start; max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem; }

  /* --- Form Panel --- */
  .form-panel {
    background: #1a1a2e;
    border-radius: 16px;
    padding: 1.8rem;
    border: 1px solid rgba(255,255,255,0.06);
    position: sticky;
    top: 1.5rem;
  }
  .form-title {
    font-size: 1.15rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .field { margin-bottom: 1.4rem; }
  .field label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    color: rgba(255,255,255,0.45);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 0.5rem;
  }

  select, input[type="text"], input[type="number"] {
    width: 100%;
    padding: 0.65rem 0.85rem;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    font-size: 0.9rem;
    font-family: inherit;
    background: rgba(255,255,255,0.04);
    color: #e0e0e0;
    transition: all 0.2s;
  }
  select option { background: #1a1a2e; color: #e0e0e0; }
  select:focus, input:focus {
    outline: none;
    border-color: #f97316;
    box-shadow: 0 0 0 3px rgba(249,115,22,0.15);
  }

  /* Price chips */
  .chips { display: flex; gap: 0.5rem; }
  .chip {
    flex: 1;
    padding: 0.5rem;
    border: 1.5px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
    color: rgba(255,255,255,0.5);
    transition: all 0.2s;
    user-select: none;
  }
  .chip:hover { border-color: rgba(249,115,22,0.4); color: #f97316; }
  .chip.active {
    background: rgba(249,115,22,0.15);
    color: #f97316;
    border-color: #f97316;
  }

  /* Rating slider */
  .slider-row { display: flex; align-items: center; gap: 0.8rem; }
  .slider-row input[type="range"] {
    flex: 1;
    -webkit-appearance: none;
    height: 6px;
    border-radius: 3px;
    background: rgba(255,255,255,0.1);
    outline: none;
  }
  .slider-row input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #f97316;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(249,115,22,0.4);
  }
  .slider-val {
    min-width: 2.5rem;
    text-align: center;
    font-weight: 700;
    color: #f97316;
    font-size: 1rem;
    background: rgba(249,115,22,0.1);
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
  }

  /* Cuisine multi-select */
  .cuisine-select { position: relative; }
  .cuisine-input {
    width: 100%;
    padding: 0.65rem 0.85rem;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    font-size: 0.9rem;
    font-family: inherit;
    background: rgba(255,255,255,0.04);
    color: #e0e0e0;
  }
  .cuisine-input:focus {
    outline: none;
    border-color: #f97316;
    box-shadow: 0 0 0 3px rgba(249,115,22,0.15);
  }
  .cuisine-dropdown {
    display: none;
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    background: #1e1e32;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 100;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  }
  .cuisine-dropdown.open { display: block; }
  .cuisine-dropdown::-webkit-scrollbar { width: 6px; }
  .cuisine-dropdown::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }
  .cuisine-option {
    padding: 0.5rem 0.85rem;
    cursor: pointer;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    color: rgba(255,255,255,0.7);
    transition: background 0.15s;
  }
  .cuisine-option:hover { background: rgba(249,115,22,0.1); color: #fff; }
  .cuisine-option input { accent-color: #f97316; }
  .selected-cuisines { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.5rem; }
  .cuisine-tag {
    background: rgba(249,115,22,0.15);
    color: #f97316;
    padding: 0.25rem 0.65rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }
  .cuisine-tag .remove {
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    opacity: 0.6;
    transition: opacity 0.15s;
  }
  .cuisine-tag .remove:hover { opacity: 1; }

  /* Buttons */
  .btn-search {
    width: 100%;
    padding: 0.85rem;
    background: linear-gradient(135deg, #f97316, #ea580c);
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 15px rgba(249,115,22,0.3);
  }
  .btn-search:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(249,115,22,0.4); }
  .btn-search:active { transform: translateY(0); }
  .btn-search:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-clear {
    width: 100%;
    padding: 0.6rem;
    background: transparent;
    color: rgba(255,255,255,0.4);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    font-size: 0.85rem;
    font-family: inherit;
    cursor: pointer;
    margin-top: 0.6rem;
    transition: all 0.2s;
  }
  .btn-clear:hover { color: rgba(255,255,255,0.7); border-color: rgba(255,255,255,0.2); }

  /* --- Results Panel --- */
  .results-panel { min-height: 300px; }

  .results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.2rem;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .results-header h2 { font-size: 1.15rem; font-weight: 600; color: #fff; }
  .results-meta { display: flex; align-items: center; gap: 0.5rem; }
  .results-count {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.4);
    background: rgba(255,255,255,0.05);
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
  }
  .variant-badge {
    font-size: 0.7rem;
    font-weight: 600;
    color: #818cf8;
    background: rgba(99,102,241,0.15);
    padding: 0.25rem 0.6rem;
    border-radius: 20px;
  }
  .btn-share {
    padding: 0.3rem 0.75rem;
    background: transparent;
    border: 1px solid rgba(249,115,22,0.3);
    border-radius: 8px;
    color: #f97316;
    font-size: 0.78rem;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-share:hover { background: rgba(249,115,22,0.1); }

  /* Active filters */
  .active-filters {
    display: none;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 1rem;
  }
  .active-filters.show { display: flex; }
  .filter-tag {
    background: rgba(99,102,241,0.15);
    color: #818cf8;
    padding: 0.2rem 0.6rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 500;
  }

  .spinner {
    display: none;
    text-align: center;
    padding: 5rem 0;
  }
  .spinner.show { display: block; }
  .spinner-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #f97316;
    margin: 0 4px;
    animation: bounce 1.4s ease-in-out infinite;
  }
  .spinner-dot:nth-child(2) { animation-delay: 0.2s; }
  .spinner-dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
    40% { transform: scale(1); opacity: 1; }
  }
  .spinner-text { color: rgba(255,255,255,0.4); font-size: 0.85rem; margin-top: 1rem; }

  .empty-state {
    display: none;
    text-align: center;
    padding: 4rem 2rem;
    color: rgba(255,255,255,0.35);
  }
  .empty-state.show { display: block; }
  .empty-state .empty-icon { font-size: 2.5rem; margin-bottom: 0.8rem; }

  .welcome-state {
    text-align: center;
    padding: 5rem 2rem;
    color: rgba(255,255,255,0.25);
  }
  .welcome-state .welcome-icon { font-size: 3rem; margin-bottom: 1rem; }
  .welcome-state h3 { color: rgba(255,255,255,0.5); font-size: 1.1rem; margin-bottom: 0.5rem; }
  .welcome-state p { font-size: 0.85rem; }

  /* --- Restaurant Card --- */
  .card {
    background: #1a1a2e;
    border-radius: 14px;
    padding: 1.4rem 1.6rem;
    margin-bottom: 0.8rem;
    border: 1px solid rgba(255,255,255,0.04);
    transition: all 0.2s;
    position: relative;
  }
  .card:hover {
    border-color: rgba(249,115,22,0.2);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  }

  .card-rank {
    position: absolute;
    top: 1.2rem;
    right: 1.4rem;
    font-size: 0.7rem;
    font-weight: 700;
    color: rgba(255,255,255,0.15);
  }

  .card-name {
    font-size: 1.15rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 0.6rem;
    padding-right: 3rem;
  }

  .card-stats {
    display: flex;
    gap: 0.6rem;
    margin-bottom: 0.7rem;
    flex-wrap: wrap;
  }
  .stat {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.3rem 0.7rem;
    border-radius: 8px;
    font-size: 0.78rem;
    font-weight: 600;
  }
  .stat-rating { background: rgba(34,197,94,0.12); color: #4ade80; }
  .stat-price { background: rgba(249,115,22,0.12); color: #fb923c; }
  .stat-locality { background: rgba(99,102,241,0.12); color: #a5b4fc; }

  .card-cuisines {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
    margin-bottom: 0.6rem;
  }
  .ctag {
    background: rgba(255,255,255,0.05);
    color: rgba(255,255,255,0.5);
    padding: 0.2rem 0.55rem;
    border-radius: 6px;
    font-size: 0.72rem;
  }

  .card-address {
    font-size: 0.78rem;
    color: rgba(255,255,255,0.25);
    margin-bottom: 0.5rem;
  }

  .card-reason {
    color: rgba(255,255,255,0.65);
    font-size: 0.85rem;
    margin-top: 0.8rem;
    padding: 0.8rem;
    background: rgba(249,115,22,0.06);
    border-radius: 8px;
    border-left: 3px solid #f97316;
    line-height: 1.5;
  }
  .card-reason::before { content: 'AI says: '; font-weight: 600; color: #f97316; }

  .card-score-bar {
    margin-top: 0.7rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }
  .score-track {
    flex: 1;
    height: 4px;
    background: rgba(255,255,255,0.06);
    border-radius: 2px;
    overflow: hidden;
  }
  .score-fill {
    height: 100%;
    border-radius: 2px;
    background: linear-gradient(90deg, #f97316, #fbbf24);
    transition: width 0.5s ease;
  }
  .score-label { font-size: 0.7rem; color: rgba(255,255,255,0.3); min-width: 3rem; text-align: right; }

  /* Card actions (feedback + save) */
  .card-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.8rem;
    padding-top: 0.7rem;
    border-top: 1px solid rgba(255,255,255,0.04);
  }
  .fb-btn {
    padding: 0.35rem 0.7rem;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    background: transparent;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
    color: rgba(255,255,255,0.4);
  }
  .fb-btn:hover { border-color: rgba(255,255,255,0.2); color: #fff; }
  .fb-btn.selected-up { background: rgba(34,197,94,0.15); border-color: #4ade80; color: #4ade80; }
  .fb-btn.selected-down { background: rgba(239,68,68,0.15); border-color: #f87171; color: #f87171; }
  .fb-btn:disabled { opacity: 0.5; cursor: default; }
  .save-btn {
    margin-left: auto;
    padding: 0.35rem 0.7rem;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    background: transparent;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
    color: rgba(255,255,255,0.4);
  }
  .save-btn:hover { border-color: rgba(255,255,255,0.2); color: #fbbf24; }
  .save-btn.saved { color: #fbbf24; border-color: #fbbf24; background: rgba(251,191,36,0.1); }

  /* --- Toast --- */
  .toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: #1a1a2e;
    border: 1px solid rgba(249,115,22,0.3);
    color: #fff;
    padding: 0.8rem 1.4rem;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 500;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 1000;
  }
  .toast.show { transform: translateY(0); opacity: 1; }

  /* ========== ANALYTICS VIEW ========== */
  .analytics-view {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }
  .analytics-view h2 { font-size: 1.3rem; font-weight: 600; color: #fff; margin-bottom: 1.5rem; }

  .metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .metric-card {
    background: #1a1a2e;
    border-radius: 14px;
    padding: 1.3rem;
    border: 1px solid rgba(255,255,255,0.04);
  }
  .metric-label {
    font-size: 0.72rem;
    font-weight: 600;
    color: rgba(255,255,255,0.4);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 0.5rem;
  }
  .metric-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: #fff;
  }
  .metric-sub { font-size: 0.75rem; color: rgba(255,255,255,0.3); margin-top: 0.3rem; }

  .analytics-section {
    background: #1a1a2e;
    border-radius: 14px;
    padding: 1.5rem;
    border: 1px solid rgba(255,255,255,0.04);
    margin-bottom: 1.2rem;
  }
  .analytics-section h3 {
    font-size: 0.95rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 1rem;
  }

  .bar-chart { display: flex; flex-direction: column; gap: 0.5rem; }
  .bar-row {
    display: flex;
    align-items: center;
    gap: 0.8rem;
  }
  .bar-label {
    min-width: 120px;
    font-size: 0.8rem;
    color: rgba(255,255,255,0.6);
    text-align: right;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .bar-track {
    flex: 1;
    height: 22px;
    background: rgba(255,255,255,0.04);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
  }
  .bar-fill {
    height: 100%;
    border-radius: 6px;
    transition: width 0.5s ease;
    min-width: 2px;
  }
  .bar-fill-orange { background: linear-gradient(90deg, #f97316, #fbbf24); }
  .bar-fill-blue { background: linear-gradient(90deg, #6366f1, #818cf8); }
  .bar-fill-green { background: linear-gradient(90deg, #22c55e, #4ade80); }
  .bar-fill-red { background: linear-gradient(90deg, #ef4444, #f87171); }
  .bar-value {
    font-size: 0.75rem;
    font-weight: 600;
    color: rgba(255,255,255,0.5);
    min-width: 40px;
  }

  /* A/B Results */
  .ab-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .ab-card {
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
    padding: 1.2rem;
    text-align: center;
  }
  .ab-variant-label { font-size: 0.85rem; font-weight: 600; color: #fff; margin-bottom: 0.3rem; }
  .ab-rate { font-size: 2rem; font-weight: 700; }
  .ab-rate.variant-a { color: #818cf8; }
  .ab-rate.variant-b { color: #f97316; }
  .ab-detail { font-size: 0.75rem; color: rgba(255,255,255,0.4); margin-top: 0.3rem; }

  /* ========== SAVED VIEW ========== */
  .saved-view {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }
  .saved-view h2 { font-size: 1.3rem; font-weight: 600; color: #fff; margin-bottom: 1.5rem; }
  .saved-empty {
    text-align: center;
    padding: 4rem 2rem;
    color: rgba(255,255,255,0.3);
  }
  .saved-empty .empty-icon { font-size: 2.5rem; margin-bottom: 0.8rem; }
  .btn-clear-saved {
    padding: 0.5rem 1rem;
    background: transparent;
    border: 1px solid rgba(239,68,68,0.3);
    color: #f87171;
    border-radius: 8px;
    font-size: 0.8rem;
    font-family: inherit;
    cursor: pointer;
    margin-bottom: 1rem;
    transition: all 0.2s;
  }
  .btn-clear-saved:hover { background: rgba(239,68,68,0.1); }

  /* Responsive */
  @media (max-width: 800px) {
    .view-search.active { grid-template-columns: 1fr; }
    .form-panel { position: static; }
    header { padding: 1.5rem 1.5rem 0; }
    .logo { font-size: 1.6rem; }
    .metric-grid { grid-template-columns: 1fr 1fr; }
    .ab-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">Foodie<span>AI</span></div>
  <p class="subtitle">AI-powered restaurant recommendations for Bangalore</p>
  <div class="nav-tabs">
    <div class="nav-tab active" data-view="search">Search</div>
    <div class="nav-tab" data-view="analytics">Analytics</div>
    <div class="nav-tab" data-view="saved">Saved</div>
  </div>
</header>

<!-- ========== SEARCH VIEW ========== -->
<div class="view view-search active" id="viewSearch">
  <div class="form-panel">
    <div class="form-title">Search Restaurants</div>

    <div class="field">
      <label>Location</label>
      <select id="location">
        <option value="">Choose an area...</option>
      </select>
    </div>

    <div class="field">
      <label>Price Range</label>
      <div class="chips" id="priceChips">
        <span class="chip" data-value="$">$</span>
        <span class="chip" data-value="$$">$$</span>
        <span class="chip" data-value="$$$">$$$</span>
        <span class="chip" data-value="$$$$">$$$$</span>
      </div>
    </div>

    <div class="field">
      <label>Minimum Rating</label>
      <div class="slider-row">
        <input type="range" id="minRating" min="0" max="5" step="0.5" value="0">
        <span class="slider-val" id="ratingVal">Any</span>
      </div>
    </div>

    <div class="field">
      <label>Cuisines</label>
      <div class="cuisine-select" id="cuisineSelect">
        <input type="text" class="cuisine-input" id="cuisineInput" placeholder="Type to search cuisines..." autocomplete="off">
        <div class="cuisine-dropdown" id="cuisineDropdown"></div>
      </div>
      <div class="selected-cuisines" id="selectedCuisines"></div>
    </div>

    <div class="field">
      <label>Describe what you want</label>
      <input type="text" id="freeText" placeholder="e.g. cozy date night, rooftop vibes...">
    </div>

    <div class="field">
      <label>Max Results</label>
      <input type="number" id="limit" value="10" min="1" max="50">
    </div>

    <button class="btn-search" id="searchBtn">Find Restaurants</button>
    <button class="btn-clear" id="clearBtn">Clear All Filters</button>
  </div>

  <div class="results-panel">
    <div class="welcome-state" id="welcome">
      <div class="welcome-icon">&#127860;</div>
      <h3>Discover your next meal</h3>
      <p>Pick a location and search to get AI-powered recommendations</p>
    </div>

    <div class="spinner" id="spinner">
      <div>
        <span class="spinner-dot"></span>
        <span class="spinner-dot"></span>
        <span class="spinner-dot"></span>
      </div>
      <div class="spinner-text">Finding the best restaurants for you...</div>
    </div>

    <div class="empty-state" id="emptyState">
      <div class="empty-icon">&#128533;</div>
      <p>No restaurants found. Try broadening your filters.</p>
    </div>

    <div id="resultsHeader" style="display:none">
      <div class="active-filters" id="activeFilters"></div>
      <div class="results-header">
        <h2>Recommendations</h2>
        <div class="results-meta">
          <span class="variant-badge" id="variantBadge" style="display:none"></span>
          <span class="results-count" id="resultsCount"></span>
          <button class="btn-share" id="shareBtn" title="Copy shareable link">Share</button>
        </div>
      </div>
    </div>
    <div id="cardList"></div>
  </div>
</div>

<!-- ========== ANALYTICS VIEW ========== -->
<div class="view analytics-view" id="viewAnalytics">
  <h2>Analytics Dashboard</h2>
  <div class="metric-grid" id="metricGrid"></div>
  <div id="analyticsCharts"></div>
</div>

<!-- ========== SAVED VIEW ========== -->
<div class="view saved-view" id="viewSaved">
  <h2>Saved Restaurants</h2>
  <div id="savedContent"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
const API = '';
let allCuisines = [];
let selectedCuisines = new Set();
let currentVariant = null;
let currentSearchBody = null;
let savedRestaurants = JSON.parse(sessionStorage.getItem('savedRestaurants') || '{}');

// === NAV TABS ===
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    tab.classList.add('active');
    const viewId = 'view' + tab.dataset.view.charAt(0).toUpperCase() + tab.dataset.view.slice(1);
    document.getElementById(viewId).classList.add('active');
    if (tab.dataset.view === 'analytics') loadAnalytics();
    if (tab.dataset.view === 'saved') renderSavedView();
  });
});

// === INIT ===
async function loadMetadata() {
  try {
    const res = await fetch(`${API}/metadata`);
    const data = await res.json();
    const locSelect = document.getElementById('location');
    data.cities.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      locSelect.appendChild(opt);
    });
    allCuisines = data.cuisines;
    renderCuisineDropdown(allCuisines);
    loadFromUrlParams();
  } catch (e) {
    console.error('Failed to load metadata:', e);
  }
}

// === SHARE: URL PARAMS ===
function loadFromUrlParams() {
  const params = new URLSearchParams(window.location.search);
  if (!params.get('location')) return;
  document.getElementById('location').value = params.get('location');
  if (params.get('price_range')) {
    params.get('price_range').split(',').forEach(p => {
      const chip = document.querySelector(`#priceChips .chip[data-value="${p}"]`);
      if (chip) chip.classList.add('active');
    });
  }
  if (params.get('min_rating')) {
    document.getElementById('minRating').value = params.get('min_rating');
    document.getElementById('ratingVal').textContent = params.get('min_rating');
  }
  if (params.get('cuisines')) {
    params.get('cuisines').split(',').forEach(c => selectedCuisines.add(c));
    renderSelectedTags();
  }
  if (params.get('free_text')) {
    document.getElementById('freeText').value = params.get('free_text');
  }
  if (params.get('limit')) {
    document.getElementById('limit').value = params.get('limit');
  }
  // Auto-search with shared params
  setTimeout(doSearch, 300);
}

function buildShareUrl() {
  const loc = document.getElementById('location').value;
  if (!loc) return '';
  const params = new URLSearchParams();
  params.set('location', loc);
  const prices = [...document.querySelectorAll('#priceChips .chip.active')].map(c => c.dataset.value);
  if (prices.length) params.set('price_range', prices.join(','));
  const rating = document.getElementById('minRating').value;
  if (parseFloat(rating) > 0) params.set('min_rating', rating);
  if (selectedCuisines.size) params.set('cuisines', [...selectedCuisines].join(','));
  const freeText = document.getElementById('freeText').value.trim();
  if (freeText) params.set('free_text', freeText);
  const limit = document.getElementById('limit').value;
  if (limit && limit !== '10') params.set('limit', limit);
  return `${window.location.origin}/share?${params.toString()}`;
}

document.getElementById('shareBtn').addEventListener('click', async () => {
  const url = buildShareUrl();
  if (!url) return;
  try {
    await navigator.clipboard.writeText(url);
    showToast('Link copied to clipboard!');
  } catch {
    showToast('Could not copy link');
  }
});

// === PRICE CHIPS ===
document.getElementById('priceChips').addEventListener('click', e => {
  if (e.target.classList.contains('chip')) e.target.classList.toggle('active');
});

// === RATING SLIDER ===
const ratingSlider = document.getElementById('minRating');
const ratingVal = document.getElementById('ratingVal');
ratingSlider.addEventListener('input', () => {
  ratingVal.textContent = ratingSlider.value == 0 ? 'Any' : ratingSlider.value;
});

// === CUISINE MULTI-SELECT ===
const cuisineInput = document.getElementById('cuisineInput');
const cuisineDropdown = document.getElementById('cuisineDropdown');

function renderCuisineDropdown(list) {
  cuisineDropdown.innerHTML = '';
  list.forEach(c => {
    const div = document.createElement('div');
    div.className = 'cuisine-option';
    div.innerHTML = `<input type="checkbox" ${selectedCuisines.has(c) ? 'checked' : ''}><span>${c}</span>`;
    div.addEventListener('click', (e) => { e.stopPropagation(); toggleCuisine(c); });
    cuisineDropdown.appendChild(div);
  });
}

function toggleCuisine(c) {
  if (selectedCuisines.has(c)) selectedCuisines.delete(c);
  else selectedCuisines.add(c);
  renderSelectedTags();
  renderCuisineDropdown(filterCuisines(cuisineInput.value));
}

function renderSelectedTags() {
  const container = document.getElementById('selectedCuisines');
  container.innerHTML = '';
  selectedCuisines.forEach(c => {
    const tag = document.createElement('span');
    tag.className = 'cuisine-tag';
    tag.innerHTML = `${c} <span class="remove">&times;</span>`;
    tag.querySelector('.remove').addEventListener('click', (e) => { e.stopPropagation(); toggleCuisine(c); });
    container.appendChild(tag);
  });
}

function filterCuisines(query) {
  const q = query.toLowerCase();
  return allCuisines.filter(c => c.toLowerCase().includes(q));
}

cuisineInput.addEventListener('focus', () => cuisineDropdown.classList.add('open'));
cuisineInput.addEventListener('input', () => {
  renderCuisineDropdown(filterCuisines(cuisineInput.value));
  cuisineDropdown.classList.add('open');
});
document.addEventListener('click', e => {
  if (!document.getElementById('cuisineSelect').contains(e.target)) {
    cuisineDropdown.classList.remove('open');
  }
});

// === CLEAR ALL ===
document.getElementById('clearBtn').addEventListener('click', () => {
  document.getElementById('location').value = '';
  document.querySelectorAll('#priceChips .chip').forEach(c => c.classList.remove('active'));
  ratingSlider.value = 0;
  ratingVal.textContent = 'Any';
  selectedCuisines.clear();
  renderSelectedTags();
  cuisineInput.value = '';
  renderCuisineDropdown(allCuisines);
  document.getElementById('freeText').value = '';
  document.getElementById('limit').value = 10;
});

// === SEARCH ===
document.getElementById('searchBtn').addEventListener('click', doSearch);
document.addEventListener('keydown', e => {
  if (e.key === 'Enter' && e.target.tagName !== 'SELECT') doSearch();
});

async function doSearch() {
  const location = document.getElementById('location').value;
  if (!location) {
    document.getElementById('location').style.borderColor = '#ef4444';
    setTimeout(() => document.getElementById('location').style.borderColor = '', 2000);
    return;
  }

  const priceRange = [...document.querySelectorAll('#priceChips .chip.active')].map(c => c.dataset.value);
  const minRating = parseFloat(document.getElementById('minRating').value);
  const freeText = document.getElementById('freeText').value.trim() || null;
  const limit = parseInt(document.getElementById('limit').value) || 10;

  const body = {
    location,
    price_range: priceRange.length ? priceRange : null,
    min_rating: minRating,
    cuisines: [...selectedCuisines],
    free_text_preferences: freeText,
    limit,
  };
  currentSearchBody = body;

  // UI states
  document.getElementById('welcome').style.display = 'none';
  document.getElementById('emptyState').classList.remove('show');
  document.getElementById('resultsHeader').style.display = 'none';
  document.getElementById('cardList').innerHTML = '';
  document.getElementById('spinner').classList.add('show');
  document.getElementById('searchBtn').disabled = true;
  document.getElementById('searchBtn').textContent = 'Searching...';

  try {
    const res = await fetch(`${API}/recommendations`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });
    const data = await res.json();
    currentVariant = data.variant || null;
    renderActiveFilters(body);
    renderResults(data);
  } catch (e) {
    console.error(e);
    document.getElementById('emptyState').querySelector('p').textContent = 'Something went wrong. Please try again.';
    document.getElementById('emptyState').classList.add('show');
  } finally {
    document.getElementById('spinner').classList.remove('show');
    document.getElementById('searchBtn').disabled = false;
    document.getElementById('searchBtn').textContent = 'Find Restaurants';
  }
}

function renderActiveFilters(body) {
  const container = document.getElementById('activeFilters');
  container.innerHTML = '';
  const tags = [];
  tags.push(body.location);
  if (body.price_range) tags.push(body.price_range.join(' '));
  if (body.min_rating > 0) tags.push(`${body.min_rating}+ stars`);
  if (body.cuisines.length) body.cuisines.forEach(c => tags.push(c));
  if (body.free_text_preferences) tags.push(`"${body.free_text_preferences}"`);

  tags.forEach(t => {
    const tag = document.createElement('span');
    tag.className = 'filter-tag';
    tag.textContent = t;
    container.appendChild(tag);
  });
  container.classList.add('show');
}

function renderResults(data) {
  const list = document.getElementById('cardList');
  list.innerHTML = '';

  if (!data.recommendations || data.recommendations.length === 0) {
    document.getElementById('emptyState').classList.add('show');
    return;
  }

  document.getElementById('resultsHeader').style.display = 'block';
  document.getElementById('resultsCount').textContent =
    `${data.recommendations.length} of ${data.total_candidates}`;

  // Show variant badge
  const variantBadge = document.getElementById('variantBadge');
  if (data.variant) {
    variantBadge.textContent = `Variant ${data.variant}`;
    variantBadge.style.display = 'inline-block';
  } else {
    variantBadge.style.display = 'none';
  }

  data.recommendations.forEach((item, i) => {
    const r = item.restaurant;
    const card = document.createElement('div');
    card.className = 'card';
    const isSaved = !!savedRestaurants[r.id];

    const cuisineTags = r.cuisines.map(c => `<span class="ctag">${c}</span>`).join('');
    const ratingHtml = r.avg_rating != null
      ? `<span class="stat stat-rating">&#9733; ${r.avg_rating.toFixed(1)}</span>` : '';
    const reasonHtml = item.reason
      ? `<div class="card-reason">${item.reason}</div>` : '';
    const scorePercent = Math.min(100, Math.round(item.score * 100));

    card.innerHTML = `
      <div class="card-rank">#${i + 1}</div>
      <div class="card-name">${r.name}</div>
      <div class="card-stats">
        ${ratingHtml}
        <span class="stat stat-price">${r.price_bucket}${r.avg_cost_for_two ? ' ~ \u20B9' + r.avg_cost_for_two : ''}</span>
        <span class="stat stat-locality">${r.locality}</span>
      </div>
      <div class="card-cuisines">${cuisineTags}</div>
      <div class="card-address">${r.address}</div>
      ${reasonHtml}
      <div class="card-score-bar">
        <div class="score-track"><div class="score-fill" style="width:${scorePercent}%"></div></div>
        <span class="score-label">${scorePercent}%</span>
      </div>
      <div class="card-actions">
        <button class="fb-btn fb-up" data-id="${r.id}" title="Good recommendation">&#128077;</button>
        <button class="fb-btn fb-down" data-id="${r.id}" title="Not helpful">&#128078;</button>
        <button class="save-btn ${isSaved ? 'saved' : ''}" data-id="${r.id}" title="${isSaved ? 'Unsave' : 'Save'}">${isSaved ? '&#9733;' : '&#9734;'}</button>
      </div>
    `;

    // Feedback handlers
    const upBtn = card.querySelector('.fb-up');
    const downBtn = card.querySelector('.fb-down');
    upBtn.addEventListener('click', () => sendFeedback(r.id, true, upBtn, downBtn));
    downBtn.addEventListener('click', () => sendFeedback(r.id, false, upBtn, downBtn));

    // Save handler
    const saveBtn = card.querySelector('.save-btn');
    saveBtn.addEventListener('click', () => toggleSave(r, item, saveBtn));

    list.appendChild(card);
  });
}

// === FEEDBACK ===
async function sendFeedback(restaurantId, isPositive, upBtn, downBtn) {
  const loc = document.getElementById('location').value;
  try {
    await fetch(`${API}/feedback`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        restaurant_id: restaurantId,
        query_location: loc,
        is_positive: isPositive,
        variant: currentVariant,
      }),
    });
    upBtn.disabled = true;
    downBtn.disabled = true;
    if (isPositive) {
      upBtn.classList.add('selected-up');
    } else {
      downBtn.classList.add('selected-down');
    }
    showToast(isPositive ? 'Thanks! Glad you liked it' : 'Thanks for the feedback');
  } catch (e) {
    console.error('Feedback error:', e);
  }
}

// === SAVE/BOOKMARK ===
function toggleSave(restaurant, item, btn) {
  if (savedRestaurants[restaurant.id]) {
    delete savedRestaurants[restaurant.id];
    btn.classList.remove('saved');
    btn.innerHTML = '&#9734;';
    btn.title = 'Save';
    showToast('Removed from saved');
  } else {
    savedRestaurants[restaurant.id] = { restaurant, score: item.score, reason: item.reason };
    btn.classList.add('saved');
    btn.innerHTML = '&#9733;';
    btn.title = 'Unsave';
    showToast('Saved!');
  }
  sessionStorage.setItem('savedRestaurants', JSON.stringify(savedRestaurants));
}

// === SAVED VIEW ===
function renderSavedView() {
  const container = document.getElementById('savedContent');
  const entries = Object.values(savedRestaurants);
  if (entries.length === 0) {
    container.innerHTML = `
      <div class="saved-empty">
        <div class="empty-icon">&#9734;</div>
        <p>No saved restaurants yet. Search and bookmark your favorites!</p>
      </div>`;
    return;
  }

  let html = `<button class="btn-clear-saved" id="clearSavedBtn">Clear All Saved</button>`;
  entries.forEach(entry => {
    const r = entry.restaurant;
    const cuisineTags = r.cuisines.map(c => `<span class="ctag">${c}</span>`).join('');
    const ratingHtml = r.avg_rating != null
      ? `<span class="stat stat-rating">&#9733; ${r.avg_rating.toFixed(1)}</span>` : '';
    const reasonHtml = entry.reason
      ? `<div class="card-reason">${entry.reason}</div>` : '';
    html += `
      <div class="card">
        <div class="card-name">${r.name}</div>
        <div class="card-stats">
          ${ratingHtml}
          <span class="stat stat-price">${r.price_bucket}${r.avg_cost_for_two ? ' ~ \u20B9' + r.avg_cost_for_two : ''}</span>
          <span class="stat stat-locality">${r.locality}</span>
        </div>
        <div class="card-cuisines">${cuisineTags}</div>
        <div class="card-address">${r.address}</div>
        ${reasonHtml}
      </div>`;
  });
  container.innerHTML = html;
  document.getElementById('clearSavedBtn').addEventListener('click', () => {
    savedRestaurants = {};
    sessionStorage.setItem('savedRestaurants', '{}');
    renderSavedView();
    showToast('All saved restaurants cleared');
  });
}

// === ANALYTICS ===
async function loadAnalytics() {
  try {
    const [analyticsRes, feedbackRes, cacheRes, abRes] = await Promise.all([
      fetch(`${API}/analytics`).then(r => r.json()),
      fetch(`${API}/feedback/stats`).then(r => r.json()),
      fetch(`${API}/cache/stats`).then(r => r.json()),
      fetch(`${API}/ab-test/results`).then(r => r.json()),
    ]);
    renderAnalytics(analyticsRes, feedbackRes, cacheRes, abRes);
  } catch (e) {
    console.error('Failed to load analytics:', e);
  }
}

function renderAnalytics(analytics, feedback, cache, abTest) {
  // Metric cards
  const metricGrid = document.getElementById('metricGrid');
  metricGrid.innerHTML = `
    <div class="metric-card">
      <div class="metric-label">Total Searches</div>
      <div class="metric-value">${analytics.total_searches}</div>
      <div class="metric-sub">queries processed</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Avg Response Time</div>
      <div class="metric-value">${analytics.avg_response_time_ms}ms</div>
      <div class="metric-sub">end-to-end latency</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Cache Hit Rate</div>
      <div class="metric-value">${cache.hit_rate}%</div>
      <div class="metric-sub">${cache.hits} hits / ${cache.misses} misses</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">User Satisfaction</div>
      <div class="metric-value">${feedback.satisfaction_rate}%</div>
      <div class="metric-sub">${feedback.positive} positive / ${feedback.negative} negative</div>
    </div>
  `;

  // Charts
  const charts = document.getElementById('analyticsCharts');
  let html = '';

  // Top Locations
  if (analytics.top_locations.length) {
    const maxCount = Math.max(...analytics.top_locations.map(l => l.count));
    html += `<div class="analytics-section"><h3>Top Locations</h3><div class="bar-chart">`;
    analytics.top_locations.forEach(l => {
      const pct = Math.round(l.count / maxCount * 100);
      html += `<div class="bar-row">
        <span class="bar-label">${l.name}</span>
        <div class="bar-track"><div class="bar-fill bar-fill-orange" style="width:${pct}%"></div></div>
        <span class="bar-value">${l.count}</span>
      </div>`;
    });
    html += `</div></div>`;
  }

  // Top Cuisines
  if (analytics.top_cuisines.length) {
    const maxCount = Math.max(...analytics.top_cuisines.map(c => c.count));
    html += `<div class="analytics-section"><h3>Top Cuisines</h3><div class="bar-chart">`;
    analytics.top_cuisines.forEach(c => {
      const pct = Math.round(c.count / maxCount * 100);
      html += `<div class="bar-row">
        <span class="bar-label">${c.name}</span>
        <div class="bar-track"><div class="bar-fill bar-fill-blue" style="width:${pct}%"></div></div>
        <span class="bar-value">${c.count}</span>
      </div>`;
    });
    html += `</div></div>`;
  }

  // Price Range Distribution
  const priceEntries = Object.entries(analytics.price_range_usage);
  if (priceEntries.length) {
    const maxP = Math.max(...priceEntries.map(e => e[1]));
    html += `<div class="analytics-section"><h3>Price Range Distribution</h3><div class="bar-chart">`;
    priceEntries.forEach(([k, v]) => {
      const pct = maxP > 0 ? Math.round(v / maxP * 100) : 0;
      html += `<div class="bar-row">
        <span class="bar-label">${k}</span>
        <div class="bar-track"><div class="bar-fill bar-fill-green" style="width:${pct}%"></div></div>
        <span class="bar-value">${v}</span>
      </div>`;
    });
    html += `</div></div>`;
  }

  // Filter Usage
  html += `<div class="analytics-section"><h3>Filter Usage Rates</h3><div class="bar-chart">`;
  const filterLabels = { price_range: 'Price Range', cuisine: 'Cuisine', rating: 'Min Rating', free_text: 'Free Text' };
  Object.entries(analytics.filter_usage).forEach(([k, v]) => {
    html += `<div class="bar-row">
      <span class="bar-label">${filterLabels[k] || k}</span>
      <div class="bar-track"><div class="bar-fill bar-fill-blue" style="width:${v}%"></div></div>
      <span class="bar-value">${v}%</span>
    </div>`;
  });
  html += `</div></div>`;

  // A/B Test Results
  const exp = abTest.experiment;
  const rA = abTest.results.A;
  const rB = abTest.results.B;
  html += `<div class="analytics-section">
    <h3>A/B Test: ${exp.name || 'Scoring Weights'}</h3>
    <p style="font-size:0.8rem;color:rgba(255,255,255,0.4);margin-bottom:1rem">${exp.description || ''}</p>
    <div class="ab-grid">
      <div class="ab-card">
        <div class="ab-variant-label">${exp.variants ? exp.variants.A.label : 'Variant A'}</div>
        <div class="ab-rate variant-a">${rA.satisfaction_rate}%</div>
        <div class="ab-detail">${rA.positive} positive of ${rA.total_feedback} feedback</div>
      </div>
      <div class="ab-card">
        <div class="ab-variant-label">${exp.variants ? exp.variants.B.label : 'Variant B'}</div>
        <div class="ab-rate variant-b">${rB.satisfaction_rate}%</div>
        <div class="ab-detail">${rB.positive} positive of ${rB.total_feedback} feedback</div>
      </div>
    </div>
    <div class="ab-detail" style="text-align:center;margin-top:1rem">${abTest.total_assignments} total variant assignments</div>
  </div>`;

  charts.innerHTML = html;
}

// === TOAST ===
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}

// Boot
loadMetadata();
</script>
</body>
</html>
